<!DOCTYPE HTML>

<html>
    <head>
        <meta charset="utf-8">
	<script src="/home/stanislav/Dropbox/Programming/Python/wsgi_app.git/View/html_templates/scripts.js"></script>
    </head>
    <title>comment</title>
<body> 
    <p>
        <a href="/">Главная</a>
    </p>
   <form action="insert_comment" id="comment" method="get">
        <p>            
            <input name="surname" placeholder="Фамилия" type="text"/>
	        <div id="surname_error"></div>
        </p>     
        <p>            
            <input name="user_name" placeholder="Имя" type="text"/>
	        <div id="user_name_error"></div>
        </p>
        <p>            
            <input name="middle_name" placeholder="Отчество" type="text"/>
        </p>
        <p>
            <!-- id="region"-->
            %(get_region)s
            <!-- id="city"-->   
            %(get_city)s
        </p> 
        <p>            
            <input name="phone" placeholder="Контактный телефон" type="text"/>
	        <div id="phone_error"></div>
        </p>
        <p>            
            <input name="email" placeholder="Email" type="text"/>
	        <div id="email_error"></div>
        </p>
        <p>
            <textarea rows="10" cols="45" name="user_comment" placeholder="Комментарий" type="text"></textarea>
	        <div id="user_comment_error"></div>
        </p>
        <p>
            <input type="submit" value="Отправить">
        </p>
    </form>

        <script type="text/javascript"> 

            var form = document.getElementById('comment');

            form.onsubmit = function() {

                if (form.surname.value == '') {

                    surname_error.innerHTML = 'Введите фамилию.';
		            form.surname.style.borderColor = "red";           
                
                    return false;
                }

                if (form.user_name.value == '') {

		            user_name_error.innerHTML = 'Введите имя.';
		            form.user_name.style.borderColor = "red";
            
                    return false;
                }

                if (form.user_comment.value == '') {
		
		            user_comment_error.innerHTML = 'Введите комментарий.';
		            form.user_comment.style.borderColor = "red";

                    return false;
                }
            }   
 
        </script>
	
        <script type="text/javascript">
				
	        var comment = document.getElementById('comment');
	
            // check a surname when the field is defocused
            comment.surname.onblur = function() {

                if (comment.surname.value == '') { 

			        comment.surname.style.borderColor = "red";
		            surname_error.innerHTML = 'Введите фамилию.'

		        } else {

                    comment.surname.style.borderColor = '';
                    surname_error.innerHTML = '';            
                }
		    }

            // check a surname when the field is focused
		    comment.surname.onfocus = function() {

		        if (comment.surname.value != '') {
		            form.surname.style.borderColor = '';
		            surname_error.innerHTML = '';
		        } else {
                    comment.surname.style.borderColor = '';
                    surname_error.innerHTML = '';            
                }
		    }    

            // check a user name when the field is defocused
            comment.user_name.onblur = function() {

		        if (comment.user_name.value == '') { 
		            comment.user_name.style.borderColor = "red";
		            user_name_error.innerHTML = 'Введите имя.'
		        } else {
                    comment.user_name.style.borderColor = '';
                    user_name_error.innerHTML = '';            
                }
		    }

            // check a user name when the field is focused
		    comment.user_name.onfocus = function() {

		        if (comment.user_name.value != '') {
		            form.user_name.style.borderColor = '';
		            user_name_error.innerHTML = '';
		        } else {
                    comment.user_name.style.borderColor = '';
                    user_name_error.innerHTML = '';            
                }
		    }  

            // check a user comment when the field is defocused
            comment.user_comment.onblur = function() {

		        if (comment.user_comment.value == '') { 
		            comment.user_comment.style.borderColor = "red";
		            user_comment_error.innerHTML = 'Введите комментарий.'
		        } else {
                    comment.user_comment.style.borderColor = '';
                    user_comment_error.innerHTML = '';            
                }
		    }

            // check a user comment when the field is focused
		    comment.user_comment.onfocus = function() {

		        if (comment.user_comment.value != '') {
		            form.user_comment.style.borderColor = '';
		            user_comment_error.innerHTML = '';
		        } else {
                    comment.user_comment.style.borderColor = '';
                    user_comment_error.innerHTML = '';            
                }
		    }  

	        // check an email when the field is defocused
		    comment.email.onblur = function() {

		        var re = /^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i;
                var valid = re.test(comment.email.value);
  
		        if (comment.email.value != '') {	
			        if (!valid) { 
			            comment.email.style.borderColor = 'red';
			            email_error.innerHTML = 'Введите корректный email в формате "example@gmail.com".';
			        } else {
                        comment.email.style.borderColor = '';
                        email_error.innerHTML = '';
                    }
		        } else {
                    comment.email.style.borderColor = '';
                    email_error.innerHTML = '';
                }
            }

            // check an email when the field is focused
            comment.email.onfocus = function() {

                var re = /^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,4}$/i;
                var valid = re.test(comment.email.value);
 
                if (comment.email.value != '') {
                    if(!valid) {
                        comment.email.style.borderColor = 'red';
			            email_error.innerHTML = 'Введите корректный email в формате "example@gmail.com".';
                    } else {
                        comment.email.style.borderColor = '';
                        email_error.innerHTML = '';
                    }  
                } else {
                    comment.email.style.borderColor = '';
			        email_error.innerHTML = "";
                }    
               
		    }

		    // check a phone number when the field is defocused
		    comment.phone.onblur = function() {
	            
                var re = /^[\d\ ]{1,2}\([\d]{2,3}\)[\d\(\)\ -]{4,14}\d$/;
                var valid = re.test(comment.phone.value);
                
                if (comment.phone.value != '') {
		            if (!valid) { 
		                comment.phone.style.borderColor = 'red';
		                phone_error.innerHTML = 'Введите телефон в формате «(код города) номер» Пример: 8(961)5111934.';
		            } else {
                        comment.phone.style.borderColor = '';
                        phone_error.innerHTML = '';
                    }
		        } else {
                    comment.phone.style.borderColor = '';
                    phone_error.innerHTML = '';
                }
            }

            // check a phone number when the field is focused
            comment.phone.onfocus = function() {

                var re = /^[\d\ ]{1,2}\([\d]{2,3}\)[\d\(\)\ -]{4,14}\d$/;
                var valid = re.test(comment.phone.value);
                
                if (comment.phone.value != '') {
		            if (!valid) { 
		                comment.phone.style.borderColor = 'red';
		                phone_error.innerHTML = 'Введите телефон в формате «(код города) номер» Пример: 8(961)5111934.';
		            } else {
                        comment.phone.style.borderColor = '';
                        phone_error.innerHTML = '';
                    }
		        } else {
                    comment.phone.style.borderColor = '';
                    phone_error.innerHTML = '';
                }
            }
        </script>

        <script type="text/javascript">

            var region = document.getElementById('region');

            region.onchange = function() {
               
                var xhr = new XMLHttpRequest();
                
                xhr.open('GET', '/get_cities?region=' + region.value, true);

                xhr.send();

                xhr.onreadystatechange = function() {
                    
                    if (xhr.readyState != 4) return;
        
                    if (xhr.status != 200) {
                        alert (xhr.status + ':' + xhr.statusText);
                     } else {
                       document.getElementById('city').innerHTML = xhr.responseText;      
                     }        
                }
            }

        </script>

</body>
</html>
